node {
    stage ('checkout scm') {
	git branch: 'main', url: 'https://github.com/nivav1/Project_1.git'
    }
    stage ('Build infrastructure and configuration') {
        dir ('./Project_1')
        terraform init
        terraform apply --auto-approve
        sh 'bash machine_ip'
        sh 'ansible-playbook -i host.ini installdocker.yml'
    }
    stage ('Deploy application') {
        sh 'ansible-playbook -i host.ini deploy.yml'
    }
}
