node {
    stage ('checkout scm') {
	git branch: 'main', url: 'https://github.com/nivav1/Project_1.git'
    }
    stage ('Build infrastructure and configuration') {
        env.machine_ip = sh(script: ". ./machine_ip.sh", returnStdout: true).trim()
        sh 'ansible-playbook -i host.ini installdocker.yml -vvv'
    }
    stage ('Deploy application') {
        sh "ansible-playbook -i host.ini deploy.yml -e machine_ip=${env.machine_ip}"
    }
}
